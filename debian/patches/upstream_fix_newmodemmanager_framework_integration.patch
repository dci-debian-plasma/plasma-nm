From: Jan Grulich <jgrulich@redhat.com>
Date: Tue, 31 Mar 2015 12:37:16 +0000
Subject: Adapt to modemmanager-qt API changes
X-Git-Url: http://quickgit.kde.org/?p=plasma-nm.git&a=commitdiff&h=4d72cb7966edda33bc72c77fc2a126844fc1f134
---
Adapt to modemmanager-qt API changes
---


Index: plasma-nm-5.2.2/libs/models/networkmodel.cpp
===================================================================
--- plasma-nm-5.2.2.orig/libs/models/networkmodel.cpp
+++ plasma-nm-5.2.2/libs/models/networkmodel.cpp
@@ -246,10 +246,10 @@ void NetworkModel::initializeSignals(con
             if (modem->hasInterface(ModemManager::ModemDevice::ModemInterface)) {
                 ModemManager::Modem::Ptr modemNetwork = modem->interface(ModemManager::ModemDevice::ModemInterface).objectCast<ModemManager::Modem>();
                 if (modemNetwork) {
-                    connect(modemNetwork.data(), SIGNAL(signalQualityChanged(uint)),
-                            SLOT(gsmNetworkSignalQualityChanged(uint)), Qt::UniqueConnection);
-                    connect(modemNetwork.data(), SIGNAL(accessTechnologyChanged(ModemManager::Modem::AccessTechnologies)),
-                            SLOT(gsmNetworkAccessTechnologyChanged(ModemManager::Modem::AccessTechnologies)), Qt::UniqueConnection);
+                    connect(modemNetwork.data(), SIGNAL(signalQualityChanged(ModemManager::SignalQualityPair)),
+                            SLOT(gsmNetworkSignalQualityChanged(ModemManager::SignalQualityPair)), Qt::UniqueConnection);
+                    connect(modemNetwork.data(), SIGNAL(accessTechnologiesChanged(QFlags<MMModemAccessTechnology>)),
+                            SLOT(gsmNetworkAccessTechnologiesChanged(QFlags<MMModemAccessTechnology>)), Qt::UniqueConnection);
                     connect(modemNetwork.data(), SIGNAL(currentModesChanged()),
                             SLOT(gsmNetworkCurrentModesChanged()), Qt::UniqueConnection);
                 }
@@ -854,9 +854,9 @@ void NetworkModel::deviceStateChanged(Ne
 }
 
 #if WITH_MODEMMANAGER_SUPPORT
-void NetworkModel::gsmNetworkAccessTechnologyChanged(ModemManager::Modem::AccessTechnologies technology)
+void NetworkModel::gsmNetworkAccessTechnologiesChanged(QFlags<MMModemAccessTechnology> accessTechnologies)
 {
-    Q_UNUSED(technology);
+    Q_UNUSED(accessTechnologies);
     ModemManager::Modem * gsmNetwork = qobject_cast<ModemManager::Modem*>(sender());
     if (gsmNetwork) {
         Q_FOREACH(const NetworkManager::Device::Ptr & dev, NetworkManager::networkInterfaces()) {
@@ -900,7 +900,7 @@ void NetworkModel::gsmNetworkCurrentMode
     }
 }
 
-void NetworkModel::gsmNetworkSignalQualityChanged(uint signal)
+void NetworkModel::gsmNetworkSignalQualityChanged(const ModemManager::SignalQualityPair &signalQuality)
 {
     ModemManager::Modem * gsmNetwork = qobject_cast<ModemManager::Modem*>(sender());
     if (gsmNetwork) {
@@ -912,7 +912,7 @@ void NetworkModel::gsmNetworkSignalQuali
                         ModemManager::Modem::Ptr modemNetwork = modem->interface(ModemManager::ModemDevice::ModemInterface).objectCast<ModemManager::Modem>();
                         if (modemNetwork && modemNetwork->device() == gsmNetwork->device()) {
                             Q_FOREACH(NetworkModelItem * item, m_list.returnItems(NetworkItemsList::Device, dev->uni())) {
-                                item->setSignal(signal);
+                                item->setSignal(signalQuality.signal);
                                 updateItem(item);
                             }
                         }
@@ -1082,7 +1082,7 @@ void NetworkModel::wirelessNetworkSignal
     if (networkPtr) {
         Q_FOREACH(NetworkModelItem * item, m_list.returnItems(NetworkItemsList::Ssid, networkPtr->ssid(), networkPtr->device())) {
             if (item->specificPath() == networkPtr->referenceAccessPoint()->uni()) {
-                item->setSignal(signal);
+	        item->setSignal(signal);
                 updateItem(item);
 //              qCDebug(PLASMA_NM) << "Wireless network " << item->name() << ": signal changed to " << item->signal();
             }
Index: plasma-nm-5.2.2/libs/models/networkmodel.h
===================================================================
--- plasma-nm-5.2.2.orig/libs/models/networkmodel.h
+++ plasma-nm-5.2.2/libs/models/networkmodel.h
@@ -95,9 +95,9 @@ private Q_SLOTS:
     void deviceRemoved(const QString& device);
     void deviceStateChanged(NetworkManager::Device::State state, NetworkManager::Device::State oldState, NetworkManager::Device::StateChangeReason reason);
 #if WITH_MODEMMANAGER_SUPPORT
-    void gsmNetworkAccessTechnologyChanged(ModemManager::Modem::AccessTechnologies technology);
+    void gsmNetworkAccessTechnologiesChanged(QFlags<MMModemAccessTechnology> accessTechnologies);
     void gsmNetworkCurrentModesChanged();
-    void gsmNetworkSignalQualityChanged(uint signal);
+    void gsmNetworkSignalQualityChanged(const ModemManager::SignalQualityPair &signalQuality);
 #endif
     void ipConfigChanged();
     void ipInterfaceChanged();
